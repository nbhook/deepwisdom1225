## 算法设计（Tree of Thoughts for 24 Game）

## 1 设计思维树

### 1.1 思维状态定义

在 Tree of Thoughts（ToT）框架中，**思维状态（Thought State）**用于描述当前推理所处的中间状态。

对于 24 点问题，一个思维状态可以定义为：
- 当前剩余的数字集合（使用有理数表示，避免浮点误差）
- 与每个数字一一对应的计算表达式，用于记录推理过程

初始状态为输入的 4 个数字；  
终止状态为只剩 1 个数字且该数字等于 24。

---

### 1.2 搜索树前两层结构（以 `[3, 8]` 为例）

- **第 0 层（根节点）**  
  `{3, 8}`

- **第 1 层（展开所有可能运算）**  
  从 `{3, 8}` 中选取一对数字 `(3, 8)`，可得到以下子状态：
  - `3 + 8 = 11` → `{11}`
  - `3 × 8 = 24` → `{24}`
  - `3 − 8 = -5` → `{-5}`
  - `8 − 3 = 5` → `{5}`
  - `3 ÷ 8 = 3/8` → `{3/8}`
  - `8 ÷ 3 = 8/3` → `{8/3}`

这些结果构成了思维树在第一层的多个分支。  
在完整的 24 点问题中，后续层将继续对剩余数字进行合并，逐层展开。

---

### 1.3 避免重复搜索的方法（5 分）

为减少重复搜索和无效计算，采用以下方法：
1. **状态去重**：  
   使用排序后的剩余数字多重集合（有理数表示）作为唯一 key，已访问状态不再展开
2. **对称性消除**：  
   - 加法和乘法只计算一次（满足交换律）
   - 减法和除法分别计算两个方向

---

## 1.2 评价函数（10 分）

### 1.2.1 评价标准（5 分）

评价函数 `evaluate(state) → [0,1]` 主要依据：
- 当前状态中是否存在接近目标值 24 的中间结果
- 中间计算结果的稳定性与合理性（避免复杂分数）
- 为搜索过程提供方向性指导，而非保证一步得到正确解

---

### 1.2.2 计算公式（5 分）

设当前状态中的数字集合为 `numbers`，目标值为 24：

\[
d = \min_{x \in numbers} |x - 24|
\]

\[
score_{dist} = \frac{1}{1 + d}
\]

\[
score_{frac} = \frac{1}{1 + \max(denominator)}
\]

综合评价函数定义为：
\[
evaluate(state) = 0.85 \cdot score_{dist} + 0.15 \cdot score_{frac}
\]

最终结果限制在 \([0,1]\) 区间内。

---

## 1.3 搜索策略选择

**选择的搜索策略：BFS**

选择 BFS 的原因如下：
- 24 点问题的搜索深度固定（最多 3 层）
- BFS 按层展开，结构清晰，符合思维树逐步扩展的思想
- 结合状态去重与评价函数剪枝，能够在保证正确性的同时控制搜索规模
- 实现简单，便于后续扩展至 DFS 或 Beam Search
